\ProvidesPackage{mylayout}

\openany

\graphicspath{{../../images/}}

\def\gobble@spaces{\@ifnextchar\space{\@gobble\gobble@spaces}{}}
%\newcommand{\verseref}[1]{\mbox{}\marginpar{\vspace*{-0.5\marginparpush}\vspace*{1.2pt}\oldNumFont #1.}\gobble@spaces}
\newcommand{\verseref}[1]{\mbox{}\marginpar{\vspace*{-6pt}\footSize #1.}\gobble@spaces}

\setlength{\vleftmargin}{0pt}

\makechapterstyle{diamond}{
  \chapterstyle{default}
  \setlength{\beforechapskip}{-11.5mm}
  \setlength{\midchapskip}{0pt}
  \setlength{\afterchapskip}{2.5\onelineskip}
  \renewcommand\printchaptername{}
  \renewcommand\printchapternum{}
  \renewcommand\printchapternonum{}
  \renewcommand\chaptitlefont{\chapterTitleFont\chapterTitleSize}
  \renewcommand*\printchaptertitle[1]{%
    \begin{tikzpicture}
      \node (rulebox) [
        rectangle, draw=none, fill=none,
        minimum width=\linewidth,
      ] {};
      \draw [line width=0.4pt, color=black!80] (rulebox.west) -- (rulebox.east);
      \node (diamond) [
        above=-0.7pt of rulebox.mid,
        anchor=mid,
        rectangle, fill=black!80,
        minimum width=2pt,
        minimum height=2pt,
        rotate=45,
      ] {};
      \node (title) [
        above=32pt of rulebox.mid,
        anchor=north,
      ] {\begin{minipage}{\linewidth}%
        \centering\chaptitlefont\color{chaptertitle}%
        \textls*{\MakeUppercase{##1}}%
      \end{minipage}};
    \end{tikzpicture}%
  }
}

\renewcommand\mainmatterChapterStyle{\chapterstyle{diamond}}

\newlength\capFrameHeight
\setlength{\capFrameHeight}{2\baselineskip + \heightof{\dropCapFont\dropCapSize O}}

\newlength\capIndent
\setlength{\capIndent}{\capFrameHeight + 3pt}

\newlength\anteW

\newcommand{\dropCap}[2][]{%
  \noindent
  \def\tempa{}%
  \def\tempb{#1}%
  \ifx\tempa\tempb\relax
  \else
    \setlength{\anteW}{\widthof{\dropCapFont\dropCapSize #1}}%
    \hskip -\anteW
    \hbox{%
      \begin{minipage}[b][\capFrameHeight][b]{\anteW}%
        \raisebox{\baselineskip}{\dropCapFont\dropCapSize #1}%
      \end{minipage}%
    }%
  \fi
  \hbox{\begin{tikzpicture}
    \node (cap) [rectangle, draw=black!40, inner sep=0pt, line width=0.4pt,] {%
      \begin{minipage}[b][\capFrameHeight][b]{\capFrameHeight}%
        \centering
        \raisebox{\baselineskip}{\dropCapFont\dropCapSize\MakeUppercase{#2}}%
        \par
      \end{minipage}%
    };
  \end{tikzpicture}}%
  \par
  \vskip -0.8pt
  \vskip -2\baselineskip
  \vskip -\parskip
  \noindent
  \hangindent=\capIndent
  \hangafter=-2%
}

